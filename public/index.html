<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ–åƒæ•¸æ“šé›†æ¸…ç†å„€è¡¨æ¿</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 8px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .stat-number { font-size: 2em; font-weight: bold; margin: 10px 0; }
        .stat-label { color: #666; }
        .image-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .image-card { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .image-card img { width: 100%; height: 150px; object-fit: cover; }
        .image-info { padding: 10px; }
        .tab-container { margin: 20px 0; }
        .tabs { display: flex; background: white; border-radius: 8px 8px 0 0; overflow: hidden; }
        .tab { padding: 15px 20px; cursor: pointer; border-bottom: 3px solid transparent; }
        .tab.active { border-bottom-color: #007acc; background: #f8f9fa; }
        .tab-content { display: none; background: white; padding: 20px; border-radius: 0 0 8px 8px; }
        .tab-content.active { display: block; }
        .success { color: #28a745; }
        .warning { color: #ffc107; }
        .error { color: #dc3545; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š åœ–åƒæ•¸æ“šé›†æ¸…ç†å„€è¡¨æ¿</h1>
            <p>å¯¦æ™‚ç›£æ§åœ–ç‰‡æ¸…ç†é€²åº¦å’Œçµæœ</p>
        </div>

        <div class="stats-grid" id="statsGrid">
            <!-- çµ±è¨ˆæ•¸æ“šæœƒå‹•æ…‹å¡«å…… -->
        </div>

        <div class="tab-container">
            <div class="tabs">
                <div class="tab active" onclick="showTab('cleaned')">âœ… æ¸…ç†å¾Œåœ–ç‰‡</div>
                <div class="tab" onclick="showTab('removed')">ğŸ—‘ï¸ åˆªé™¤çš„åœ–ç‰‡</div>
                <div class="tab" onclick="showTab('all')">ğŸ“ æ‰€æœ‰åœ–ç‰‡</div>
            </div>
            
            <div class="tab-content active" id="cleaned">
                <h3>æ¸…ç†å¾Œçš„é‹å‹•åœ–ç‰‡</h3>
                <div class="image-grid" id="cleanedImages">
                    <!-- æ¸…ç†å¾Œçš„åœ–ç‰‡ -->
                </div>
            </div>
            
            <div class="tab-content" id="removed">
                <h3>åˆªé™¤çš„åœ–ç‰‡</h3>
                <div class="image-grid" id="removedImages">
                    <!-- åˆªé™¤çš„åœ–ç‰‡ -->
                </div>
            </div>
            
            <div class="tab-content" id="all">
                <h3>æ‰€æœ‰åœ–ç‰‡</h3>
                <div class="image-grid" id="allImages">
                    <!-- æ‰€æœ‰åœ–ç‰‡ -->
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        
        // æ›´æ–°çµ±è¨ˆæ•¸æ“š
        socket.on('stats', (stats) => {
            updateStats(stats);
        });
        
        // æ›´æ–°åœ–ç‰‡é¡¯ç¤º
        socket.on('images', (images) => {
            updateImages(images, 'allImages');
        });
        
        function updateStats(stats) {
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">ç¸½åœ–ç‰‡æ•¸</div>
                    <div class="stat-number">${stats.total}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">æ¸…ç†å¾Œåœ–ç‰‡</div>
                    <div class="stat-number success">${stats.cleaned}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">é‡è¤‡åœ–ç‰‡</div>
                    <div class="stat-number warning">${stats.duplicates}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">éé‹å‹•åœ–ç‰‡</div>
                    <div class="stat-number error">${stats.nonSports}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">éŒ¯èª¤æ–‡ä»¶</div>
                    <div class="stat-number error">${stats.errors}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">å”¯ä¸€ç¶²åŸŸ</div>
                    <div class="stat-number">${stats.uniqueDomains}</div>
                </div>
            `;
        }
        
        function updateImages(images, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = images.map(image => `
                <div class="image-card">
                    <img src="${image.file_path}" alt="${image.category}" 
                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg=='">
                    <div class="image-info">
                        <div><strong>åˆ†é¡:</strong> ${image.category}</div>
                        <div><strong>é‹å‹•:</strong> ${image.sport_type || 'æœªçŸ¥'}</div>
                        <div><strong>ä¾†æº:</strong> ${image.domain}</div>
                    </div>
                </div>
            `).join('');
        }
        
        function showTab(tabName) {
            // éš±è—æ‰€æœ‰æ¨™ç±¤å…§å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // é¡¯ç¤ºé¸ä¸­çš„æ¨™ç±¤
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // åŠ è¼‰å°æ‡‰çš„åœ–ç‰‡æ•¸æ“š
            fetch(`/api/images?type=${tabName}&limit=20`)
                .then(response => response.json())
                .then(images => updateImages(images, `${tabName}Images`));
        }
        
        // åˆå§‹åŠ è¼‰
        fetch('/api/stats')
            .then(response => response.json())
            .then(updateStats);
            
        fetch('/api/images?type=all&limit=20')
            .then(response => response.json())
            .then(images => updateImages(images, 'allImages'));
    </script>
</body>
</html>